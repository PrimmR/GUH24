// Each thing has a: description, year, image

years = [
    {
        year_name: "4.6 Billion Years Ago",
        year: -4600000001,
        description: "Beginning of the solar system and the formation of the Earth. During this time, the surface of the Earth is extremely hot and the Earth is basically a giant magma ball floating in space.",
        image: "img/EarthFormation.png",
        x: 2,
        y: 10,
        source: "u/AlienMaster000000",
    }
    ,
    {
        year_name: "4.6 Billion Years Ago - Eon: Hadean",
        year: -4600000000,
        description: "The start of the Hadean eon. This is the first and oldest eons of the Earth's history. During this period, the Earth's surface cooled, vaporized atmospheric water condensed into liquid water and eventually a superocean covering nearly all of the planet was formed, turning Earth into an ocean planet. Volcanic outgassing and asteroid bombardments further altered the Hadean atmosphere eventually into the nitrogen- and carbon dioxide-rich.",
        image: "img/Hadean.png",
        x: 40,
        y: 20,
        source: "u/AlienMaster000000",
    }
    ,
    {
        year_name: "4 Billion Years Ago - Eon: Archean",
        year: -4000000001,
        description: "This marks the end of the Hadean eon and the start of the second eon - Archean. Archean eon lasted for 1.5 billion years. In this period, the Earth was still mostly a water world: there was continental crust, but much of it was under an ocean deeper than today's oceans. The Earth's atmosphere was also vastly different in composition from today's: the prebiotic atmosphere was a reducing atmosphere rich in methane and lacking free oxygen.",
        image: "img/Archean.png",
        x: 20,
        y: 15,
        source: "u/AlienMaster000000",
    }
    ,
    {
        year_name: "4 Billion Years Ago - Era: Eoarchean",
        year: -4000000000,
        description: "This is the start of the Eoarchean era which lasted about 400 million years. In this period, the Earth began to cool down, the atmosphere of the Earth was without oxygen and the pressure values ranged from 10 to 100 bar.",
        image: "img/Eoarchean.png",
        x: 50,
        y: 5,
        source: "u/AlienMaster000000",
    }
    ,
    {
        year_name: "3.6 Billion Years Ago - Era: Paleoarchean",
        year: -3600000000,
        description: "The Paleoarchean era lasted for about 400 million years. The earliest confirmed evidence of life comes from this era, and Vaalbara, one of Earth's earliest supercontinents, may have formed during this era. ",
        image: "img/Paleoarchean.png",
        x: 25,
        y: 30,
        source: "u/AlienMaster000000",
    }
    ,
    {
        year_name: "3.2 Billion Years Ago - Era: Mesoarchean",
        year: -3200000000,
        description: "The Mesoarchean era lasted for about 400 million years. This was the period when the first glaciation on Earth happened. The Pongola glaciation, which occurred in what is now South Africa. This was the first climate disaster on earth, as ice sheets covered areas of Swaziland and South Africa.",
        image: "img/Mesoarchean.png",
        x: 55,
        y: 35,
        source: "u/AlienMaster000000",
    }
    ,
    {
        year_name: "2.8 Billion Years Ago - Era: Neoarchean",
        year: -2800000000,
        description: "The Neoarchean era is a 300-million-year period which the Earth warmed up from the galaciation. The Earth continue to develop an atmosphere and oxygen content in the atmosphere slowly rised to around 0.1%",
        image: "img/Neoarchean.png",
        x: 30,
        y: 30,
        source: "u/AlienMaster000000",
    }
    ,
    {
        year_name: "2.5 Billion Years Ago - Eon: Proterozoic",
        year: -2500000001,
        description: "This marks the end of the Archean Eon and the start of the third, Proterozoic Eon. During this eon, Free oxygen in the atmosphere increased significantly as a result of biological activity. The most important period of change occurred between 2.3 billion and 1.8 billion years ago when free oxygen began to accumulate in the atmosphere.",
        image: "img/Proterozoic.png",
        x: 20,
        y: 30,
        source: "u/AlienMaster000000",
    }
    ,
    {
        year_name: "2.5 Billion Years Ago - Era: Paleoproterozoic",
        year: -2500000000,
        description: "The Paleoproterozoic era was a 900 million period where all surface reactants like iron were exhausted. Oxygen content rises in this period rises to around 1.5% at the end of the era.",
        image: "img/Paleoproterozoic.png",
        x: 10,
        y: 20,
        source: "u/AlienMaster000000",
    }
    ,
    {
        year_name: "1.6 Billion Years Ago - Era: Mesoproterozoic",
        year: -1600000000,
        description: "1.6 billion years ago, the Earth entered into a new era. During this period, Columbia supercontinent was broken up and another supercontinent - Rodinia was formed. Global climate was warm with very little evidence of glaciation suggesting a high concentration of greenhouses gases in the atmosphere.",
        image: "img/SuperContinent.png",
        x: 20,
        y: 35,
        source: "https://worldbuildingpasta.blogspot.com/2024/05/public-climate-data-explorations-future.html",
    }
    ,
    {
        year_name: "1 Billion Years Ago - Era: Neoproterozoic",
        year: -1000000000,
        description: "The last era of the three eras in the Proterozoic eon - Neoproterozoic Era, lasted around  460 million years. During this period, oxygen level keep rising and approches modern oxygen level. However, the Earth also experience two global glaciation.",
        image: "img/IceAge.jpeg",
        x: 10,
        y: 5,
        source: "PhonoForest",
    }
    ,
    {
        year_name: "540 Million Years Ago - Eon: Phanerozoic",
        year: -540000001,
        description: "Phanerozoic began 540 million years ago and continues to the present. This is the period which abundant animal and plant life has proliferated and diversified. Oxygen level and temperature has sattled down to around the present day value. However, there were three major glaciations in this period.",
        image: "img/Current.png",
        x: 30,
        y: 35,
        source: "Author Unknown",
    }
    ,
    {
        year_name: "540 Million Years Ago - Era: Paleozoic",
        year: -540000000,
        description: "Paleozoic Era lasted for about 287 million years. During this period, it was warm worldwide, but would be followed by an ice age, which caused glaciers to form, sending sea levels downward.",
        image: "img/Warm.jpg",
        x: 40,
        y: 10,
        source: "Stock Image",
    }
    ,
    {
        year_name: "252 Million Years Ago - Era: Mesozoic",
        year: -252000000,
        description: "The Mesozoic Era lasted for 186 million years, the Earth in this period is warm due to an increase of greenhouse gases in the atmosphere, this also cause the sea level to rise.",
        image: "img/Mesozoic.jpg",
        x: 20,
        y: 30,
        source: "freepik"
    }
    ,
    {
        year_name: "66 Million Years Ago - Era: Cenozoic",
        year: -66000000,
        description: "The Cenozoic is Earth's current geological era. Oxygen and atmospheric content stablised and Earth witnessed a rapid diversification of life-forms.",
        image: "img/Cenozoic.jpg",
        x: 35,
        y: 20,
        source: "pikisuperstar",
    }
    ,
    {
        year_name: "2.5 Million Years Ago - Quaternary Period",
        year: -2500000,
        description: "The Quaternary Period is the current geological system that the Earth is currently in. There is permanent ice on the polar regions of the Earth.",
        image: "img/Quaternary.jpg",
        x: 10,
        y: 5,
        source: "pikisuperstar",
    }
    ,
    {
        year_name: "300 Thoudsand Years Ago - First Homo Sapien",
        year: -300000,
        description: "At this time, the impact of human actions on Earth are very minimal and all effects are at a local scale. During this period, human turned from hunter-gatherers to agriculture.",
        image: "img/EarlyHuman.jpeg",
        x: 40,
        y: 5,
        source: "Jurica Cvetko",
    }
    ,
    {
        year_name: "Year 1760 - Industrial Revolution in Britain",
        year: 1760,
        description: "The start of the Industrial Revolution about 260 years ago means mankind gained the power to quickly alter the atmosphere of their home planet. The excessive use of coal and fossile fuels released a lot of greenhouse gases into the atmosphere. This immediately caused an noticible increase in the global average temperature since then.",
        image: "img/Industrial.jpg",
        x: 15,
        y: 30,
        source: "Author Unknown"
    }
    ,
    {
        year_name: "Year 1990 - Deforestation",
        year: 1990,
        description: "",
        image: "img/1990.png",
        x: 1,
        y: 1,
        source: "Us",
    }
    ,
    {
        year_name: "Year 2000 - Deforestation",
        year: 2000,
        description: "",
        image: "img/2000.png",
        x: 1,
        y: 1,
        source: "Us",
    }
    ,
    {
        year_name: "Year 2010 - Deforestation",
        year: 2010,
        description: "",
        image: "img/2010.png",
        x: 1,
        y: 1,
        source: "Us",
    }
    ,
    {
        year_name: "Year 2015 - Deforestation",
        year: 2015,
        description: "",
        image: "img/2015.png",
        x: 1,
        y: 1,
        source: "Us",
    }
    ,
    {
        year_name: "10th November 2024",
        year: 2024,
        description: "The effects of global warming is already affecting regions all over the world. We have been seeing a contantly rising sea levels, more and more extreme weathers. We are currently about 1.4 degrees warmer than pre-industrial times.",
        image: "img/Present.png",
        x: 30,
        y: 10,
        source: "u/Retronator",
    }
    ,
    {
        year_name: "Future",
        year: 2025,
        description: "Future",
        description: '<label for="CO2">CO2 (0-5,000,000,000 tonnes)</label><input type="range" min="0" max="5000000000" value="10" id="CO2" list="CO2" class="long"><label for="timescale">Timescale (0-1000 years)</label><input type="range" min="0" max="1000" value="50" id="timescale" class="long"><label for="timescale">Deforestation (0-200 MHa)</label><input type="range" min="0" max="200" value="10" id="defrst" class="long"><p id="calcOut"></p><p id="calcDesc"></p>',
        image: "img/Future.png",
        x: 2,
        y: 2,
        source: "Jukian Lucas",
    }
];

wordings = [
    "This implies a turn towards a global ice age. New land would be revealed, and many inhabited areas of europe, asia and north america would become uninhabitable from ice sheet growth.",
    "Smaller, but still noticeable effects include slightly higher tides and gradual erosion of coastal land. This is an ideal rise in sea level, made more likely with cleaner energy and political reform.",
    "This level typically increases the frequency of flooding to a given height by a factor of approximately 10. Coastal areas would experience more frequent \"sunny day flooding,\" where high tides alone are enough to cause flooding, even without storm events.<br>Increased Flood Severity During Storms: Even a modest rise in sea level means that storms push water farther inland. Coastal storms, including hurricanes and typhoons, would have more severe impacts, with flooding reaching areas that previously would not have been affected.",
    "Rising tides drive salt water farther inland, contaminating freshwater drinking supplies and crippling ecosystems that can't survive the increased salinity",
    "Low-lying communities face the need to relocate as the frequency and severity of flooding become unsustainable.<br>Farmland near coastlines is at increased risk from saltwater contamination, leading to lower crop yields and possible abandonment of arable land.<br>The cost to build barriers, raise roads, and reinforce coastal infrastructure rises substantially.",
    "This could displace tens of millions of people, particularly in developing countries. Geographic Information System (GIS) analyses have shown that such an increase would inundate critical land areas, leading to severe scarcity. This could lead to increased competition over freshwater resources, and an increased need for migration. Large displacements from countries such as India, China and the United States by coastal cities would occur, leading to increased political pressures and border disputes.<br>Low-elevation coastal zones, which are home to a significant portion of the global population, are especially vulnerable to this threat.<br>Coastal wetlands, coral reefs, and other critical ecosystems would be severely affected, leading to loss of biodiversity and degradation of natural habitats. Saltwater intrusion into freshwater aquifers could contaminate water supplies, further exacerbating the challenges faced by affected communities",
    "This is the more extreme end of climate projections, typically projected to 2200.<br>There would be massive economic costs and infrastructure losses. Ports, power plants, wastewater treatment facilities, and transportation networks would be severely affected or destroyed. Much of the world's critical infrastructure is located near coastlines, and retrofitting or moving these assets would be costly.<br>Salt contamination of freshwater sources could severely impact both drinking water and agricultural water supplies, especially in regions already facing water",
    "At this elevation, even Mount Everest would be submerged underwater. This level of flooding has never been documented, and would be catastrophic to all land life."
]

function projection(CO2_growth_rate, timescale, deforestation_rate) {
    CO2_ppm = ((250.5 * CO2_growth_rate * timescale - (4000 - deforestation_rate * timescale) * (0.3 * 250.5))) * 0.7 / 2.13; radiating_force = 5.35 * Math.log((CO2_ppm + 419.3) / 280); temperature_change = radiating_force * 3;
    glacier_volume_change = temperature_change * .055 * 30000000; thermal_expansion = 1335000000 * 0.000214 * temperature_change;
    height_gained = (glacier_volume_change / 1335000000 + thermal_expansion / 139000000)
    height_gained ||= 0
    return height_gained
}

addEventListener("wheel", (event) => {
    let slide = document.getElementById("slidebar")
    let old_slide_value = slide.value;
    if (event.wheelDelta > 0) {
        slide.value++;
    } else if (event.wheelDelta < 0) {
        slide.value--;
    }
    if (slide.value !== old_slide_value)
        slider_update(slide.value)
});

function sort_years() {
    years = years.sort((a, b) => {
        return a.year - b.year;
    })
}

function update_thingamy(v) {
    let vee = Math.round(v * 100) / 100;
    document.getElementById("calcOut").innerHTML = `${vee}m of Sea Level Rise`;

    let desc = "";
    if (vee <= 0) desc = wordings[0]
    else if (vee <= 0.1) desc = wordings[1]
    else if (vee <= 0.3) desc = wordings[2]
    else if (vee <= 0.5) desc = wordings[3]
    else if (vee <= 0.7) desc = wordings[4]
    else if (vee <= 3) desc = wordings[5]
    else if (vee <= 5) desc = wordings[6]
    else if (vee <= 8848) desc = wordings[7]
    else desc = wordings[8]

    document.getElementById("calcDesc").innerHTML = `${desc}`
}

function slider_update(y) {
    current_year = years[y];

    let source = document.getElementById("source");
    source.innerHTML = `Image Source: ${current_year.source}`

    let description = document.getElementById("desc");
    description.innerHTML = "";
    description.style.top = `${current_year.y}vw`;
    description.style.left = `${current_year.x}vw`;

    let year_title = document.createElement("h2");
    year_title.innerHTML = current_year.year_name;
    description.append(year_title);

    let desc_desc = document.createElement("p");
    desc_desc.innerHTML = current_year.description;
    description.append(desc_desc);

    description.animate({
        opacity: [0, 1],
        left: [`${current_year.x + 2}vw`, `${current_year.x}vw`]
    }, 500);

    Array.from(document.getElementsByClassName("background")).forEach(e => {
        e.style.zIndex = -11
    });

    let last_image = document.getElementById(`bg_${last_year.year}`);
    last_image.style.zIndex = -10;

    let top_image = document.getElementById(`bg_${current_year.year}`);
    top_image.style.zIndex = -9;
    top_image.animate({
        opacity: [0, 1],
    }, 500);


    // This needs to just work please
    if (current_year.year_name == "Future") {
        let uno = document.getElementById("CO2");
        let dos = document.getElementById("timescale");
        let tres = document.getElementById("defrst");

        uno.style.width = "40vw";

        // This never happened
        uno.oninput = function () {
            update_thingamy(projection(uno.value, dos.value, tres.value))

        };
        dos.oninput = function () {
            update_thingamy(projection(uno.value, dos.value, tres.value))
        };
        tres.oninput = function () {
            update_thingamy(projection(uno.value, dos.value, tres.value))
        };
    }

    // Earth greyness
    percent = 1 - (y / (years.length - 1));
    document.documentElement.style.setProperty('--earth-grey', percent);

    last_year = current_year;
}

let current_year = years[0];
let last_year = years[0];

document.addEventListener("DOMContentLoaded", () => {
    let slider = document.getElementById("slidebar");
    slider.max = years.length - 1;

    sort_years();

    years.forEach(e => {
        let image = document.createElement("img");
        image.src = e.image;
        image.id = `bg_${e.year}`;
        image.classList.add("background");
        document.getElementById("bg").append(image);
    });

    // Jank setup
    slider_update(0);

    // Update the current slider value (each time you drag the slider handle)
    slider.oninput = function () {
        slider_update(this.value);
    }
});